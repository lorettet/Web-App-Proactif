<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Accueil - Proact'IF</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div id="bonjour"></div>
        <div>
            Ce n'est pas vous ?
            <a href='' onclick='javascript:deco();'>Déconnexion</a>
        </div>
        <div>
            <button id="accueilBut">Accueil</button>
            <button id="newDemandeBut">Nouvelle Demande</button>
            <button id="histDemandeBut">Historique des demandes</button>
        </div>
        <div id='content'>
            
        </div>
    <script src="http://code.jquery.com/jquery.js"></script>
    <script>
        $(function(){
            $.ajax({
                    url: './ActionServlet',
                    type: 'POST',
                    data: {action : "AccueilClient"}, 
                    dataType: 'json',
                }).done(function(data){
                    if(data.sess === 'pasok'){
                        window.location = "./connexion.html";
                        return;
                    }
                    document.getElementById("accueilBut").focus();
                    $('#bonjour').html("Bonjour "+data.prénom+" "+data.nom+" !");
                    accueil();
                })
        });
        function deco(){
                    alert("deco");
                    $.ajax({
                        url: './ActionServlet',
                        type: 'POST',
                        data: {action : 'deconnection'},
                    }).done(function(){
                        window.location = "./connexion.html";
                    })
                }
        function accueil(){
            $('#content').html("<div>Vos demandes d'intervention récentes</div><div id='interventions'></div>");
            $.ajax({
                url: './ActionServlet',
                type: 'POST',
                data: {action : 'clientIntervRecentes'},
                dataType: 'json',
            }).done(function(data){
                alert(data.listeIntervs[0].type);
                for(var i=0; i<1; i++){
                    $('#interventions:last-child').append(
                        '<fieldset>'
                        +data.listeIntervs[i].type+' '
                        +data.listeIntervs[i].début+' '
                        +data.listeIntervs[i].status+' '
                        +'</fieldset>'
                    );
                }
            })
        }
    </script>
    </body>
</html>
