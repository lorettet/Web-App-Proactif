<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Accueil - Proact'IF</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/styleHeaderEmploye.css" />
        <link rel="stylesheet" href="css/styleAccueilEmploye.css" />

    </head>
	<header>
		<h1>Proact'IF</h1>
                <div id="infoEmp">
                    <span id="nomEmp"></span>
                    <div>Ce n'est as vous? <a href='' onclick="deco()">Déconnexion</a></div>
                </div>
                <div id="menu">
                <button>Accueil</button><button>Intervention du jour</button>
                </div>
	</header>
    <body>
        <h2>Votre intervention en cours</h2>
        <div id="main">
            <div id="info">
				<div id="one-line-info">
					<span id="type"></span>
					<span id="date"></span>
					<span id="status"></span>
				</div>
				<div id="multi-line-info">
					<div><label class="label-multi-line-info">Description : </label><p id="description"></p></div>
					<div><label class="label-multi-line-info">Client : </label><span id="client"></span></div>
					<div><label class="label-multi-line-info">Adresse : </label><span id="adresse"></span></div>
					<div><label class="label-multi-line-info">Complément : </label><span id="complement"></span></div>
				</div>
            <div id="form">
                <div>
                    <span class="label-multi-line-form">Etat de l'intervention : </span>
                    <input type="radio" name="cdr" id="ok">
                    <label for="ok">Réalisé</label>
                    <input type="radio" name="cdr" id="nok">
                    <label for="nok">Un problème est survenu</label>
                </div>
                <div>
                    <span class="label-multi-line-form" id="commentaireLabel">Commentaire : </span>
                    <textarea id="commentaire" placeholder="commentaire"></textarea>
                    <input id="submit" type="button" value="Terminé l'intervention" onclick="submit()">
                </div>
            </div>
        </div>
        <script src="http://code.jquery.com/jquery.js"></script>
        <script>
            function submit()
            {   
                var etat="text";
                if($('#ok')[0].checked)
                    etat="ok";
                else if($('#nok')[0].checked)
                    etat="nok";
                $.ajax({
                url: "./ActionServlet",
                type: 'POST',
                data: {
                    action:"ValiderIntervention",
                    etat:etat,
                    commentaire:$('#commentaire')[0].value
                }, 
                dataType: 'json'
                }).done(function(data){
                    location.reload();
                });
            }
            function addInfo(label, text)
            {
                var lastChild = $('#multi-line-info div:last-child').last()
                lastChild.append('<div><label class="label-multi-line-info">'+label+ ' : </label><span id="compInter">'+text+'</span></div>')
            }
            function initNom(data)
            {
                $('#nomEmp').html(data.employe.prenom+ " "+ data.employe.nom)

            }
            function deco()
            {
                alert("deco");
                $.ajax({
                    url: './ActionServlet',
                    type: 'POST',
                    data: {action : 'deconnection'},
                }).done(function(){
                    window.location = "./connexion.html";
                })
            }
            function initInterv(data)
            {
                $('#type').html(data.type);
                $('#date').html(data.date);
                $('#description').html(data.description);
                $('#client').html(data.client.prenom + " " + data.client.nom)
                var adresse = data.client.adresse;
                $('#adresse').html(adresse.rue + ", " + adresse.codePostal + " " + adresse.ville)
                $('#complement').html(adresse.complement);
                if(data.type==="Animal")
                {
                    addInfo("Expèce de l'animal",data.animal)
                }
                else if(data.type==="Livraison")
                {
                    addInfo("Type de livraison",data.typeLivraison);
                    addInfo("Entreprise",data.entrepriseLivraison);
                }
            }
            $(function(){
                $.ajax({
                        url: './ActionServlet',
                        type: 'POST',
                        data: {action : "InfoEmp"}, 
                    }).done(function(data){
                        if(data.sess === "pasok")
                        {
                            window.location = "./connexion.html";
                            return;
                        }
                        initNom(data)
                    });

                $.ajax({
                    url: './ActionServlet',
                    type: 'POST',
                    data: {action : "CurrentInterv"}, 
                }).done(function(data){
                    if(data.sess === "pasok")
                        window.location = "./connexion.html";
                    if(data.error==="noInterv")
                    {
                        $('#main').empty();
                        $('#main').html("<h2>Aucune intervention en cours</h2>")
                    }
                    initInterv(data.intervention)
                });
                

            });
        </script>
    </body>

</html>
